# Pitch Arena - Cursor AI Rules

## Project Context
An AI-powered platform for practicing startup pitches with diverse investor personas. Built with Next.js 15, TypeScript, Supabase, and AI integration.

## Code Style

### TypeScript
- Use strict type checking
- Define interfaces in `/lib/types.ts`
- Prefer type inference where obvious
- Use `async/await` over `.then()`

### React/Next.js
- Use App Router patterns (Next.js 15)
- Server Components by default, 'use client' only when needed
- Async params for dynamic routes: `{ params: Promise<{ id: string }> }`
- Use Next.js Image for images

### Database
- Always use functions from `/lib/supabase.ts`
- Use `maybeSingle()` instead of `single()` for nullable queries
- Enable RLS on all new tables
- Include proper indexes for performance

### Styling
- Tailwind CSS for all styling
- Use shadcn/ui components
- Follow existing design patterns
- Dark mode support required

## Architecture Patterns

### API Routes
```typescript
export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  const { id } = await params;
  // implementation
}
```

### Database Operations
```typescript
// Always use provided CRUD functions
import { getInvestorPersonas, createPitchSession } from '@/lib/supabase';

// Handle errors properly
const personas = await getInvestorPersonas();
if (!personas.length) {
  return { error: 'No personas found' };
}
```

### Component Structure
```typescript
'use client'; // Only when needed

import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';

export default function MyComponent() {
  // Component logic
}
```

## Critical Rules

### DO
- ✅ Use TypeScript for all files
- ✅ Handle errors gracefully with user feedback
- ✅ Test database operations before committing
- ✅ Follow RLS security patterns
- ✅ Use semantic HTML
- ✅ Add loading states for async operations
- ✅ Validate user input

### DON'T
- ❌ Skip error handling
- ❌ Expose API keys in client code
- ❌ Bypass RLS policies
- ❌ Use `any` type without good reason
- ❌ Create SQL queries directly (use Supabase client)
- ❌ Ignore TypeScript errors
- ❌ Add authentication without proper planning

## AI Integration

### System Prompts
- Built from persona data dynamically
- Include personality traits and investment criteria
- Specify JSON response format
- Provide scoring guidelines

### Response Handling
```typescript
interface AIResponse {
  reply_text: string;
  score_adjustment: number; // -20 to +20
  feedback_hidden: string;
}
```

## Database Schema

### Key Tables
1. **investor_personas**: AI investor profiles
2. **pitch_sessions**: User pitch history

### Common Queries
```typescript
// Get all personas
const personas = await getInvestorPersonas();

// Create session
const session = await createPitchSession(userId, personaId);

// Update session
await updatePitchSession(sessionId, { outcome: 'win' });

// Get user stats
const stats = await getUserPitchStats(userId);
```

## Testing Checklist

Before committing:
1. ✅ TypeScript compiles without errors
2. ✅ Build succeeds (`npm run build`)
3. ✅ No console errors in dev mode
4. ✅ Database operations tested
5. ✅ UI responsive on mobile
6. ✅ Error states handled
7. ✅ Loading states shown

## Documentation
Refer to `/docs` for:
- Setup instructions
- API documentation
- Architecture details
- Database schema
- Contributing guidelines

## Common Pitfalls

### Next.js 15 Changes
- Params are now async: `await params`
- No more `getServerSideProps`
- Use Server Actions for mutations

### Supabase
- Always check for errors after queries
- Use RLS policies, don't bypass them
- Test queries in Supabase SQL editor first

### TypeScript
- Don't use `as` unless absolutely necessary
- Prefer union types over `any`
- Use proper generics for reusable functions

## File Organization
```
/app
  /api/[endpoint]/route.ts - API endpoints
  /[page]/page.tsx - Pages
/components
  /ui - shadcn components
  [feature].tsx - Feature components
/lib
  supabase.ts - Database operations
  types.ts - Type definitions
  utils.ts - Utility functions
```

## Quick Reference

### Environment Setup
```bash
npm install
npm run dev
```

### Database Operations
```typescript
import { supabase } from '@/lib/supabase';
// Always use the exported functions, not direct queries
```

### Adding New Features
1. Define types in `/lib/types.ts`
2. Create database functions in `/lib/supabase.ts`
3. Build API routes in `/app/api`
4. Create UI components
5. Test thoroughly
6. Update documentation

## Resources
- Next.js Docs: https://nextjs.org/docs
- Supabase Docs: https://supabase.com/docs
- Tailwind CSS: https://tailwindcss.com/docs
- shadcn/ui: https://ui.shadcn.com
